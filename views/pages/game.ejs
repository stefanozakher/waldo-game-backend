<!-- views/pages/game.ejs -->
<div class="d-flex flex-column vh-100">
    <!-- Top Bar -->
    <div class="container-fluid p-3">
        <div class="row">
            <div class="col text-left">
                <p>Game Session: <%= gameSession.short_id %>
                    <span id="gameStatus" class="badge 
                                <%= gameSession.status === 'waiting' ? 'badge-secondary' :
                                    gameSession.status === 'playing' ? 'badge-primary' :
                                    gameSession.status === 'completed' ? 'badge-success' : 'badge-info' %>">
                        <%= gameSession.status.charAt(0).toUpperCase() + gameSession.status.slice(1) %>
                    </span>
                </p>
            </div>
            <div class="col text-center">
                <% if (gameSession.status !=='completed' ) { %>
                <p>Time left:
                    <span id="gameSessionTimer" class="timer-value">
                        <% if (gameSession.status==='playing' ) { %>
                            <% var elapsedSeconds=Math.floor((gameSession.started_at + (gameSession.playtime_in_seconds * 1000) - Date.now()) / 1000) %>
                            <%= Math.floor(elapsedSeconds / 60) %>:<%= (elapsedSeconds % 60).toString().padStart(2, '0' ) %>
                        <% } else { %>
                            <%= Math.floor(gameSession.playtime_in_seconds / 60) %>:<%= (gameSession.playtime_in_seconds % 60).toString().padStart(2, '0' ) %>
                        <% } %>
                    </span>
                </p>
                <% } %>
            </div>
            <div class="col text-right">
             <!-- Button to copy the current URL into the clipboard -->
                <button class="btn btn-primary" onclick="copyGameLinkToClipboard()">Share Link</button>
            </div>
        </div>
    </div>

    <div class="container-fluid flex-grow-1">
        <div class="row h-100">
            <!-- Player List -->
            <div class="col-md-3 border-end">
                <%- include('gamePlayerlist.ejs') %>
            </div>

            <div class="col-md-6 d-flex align-items-center justify-content-center">
                <div class="bg-secondary text-white p-5 rounded">
                    <h2 class="text-center mb-4">Game Board</h2>
                    <!-- Add this new div for the start button -->
                    <div id="startGameContainer" class="text-center mt-3" style="display: none;">
                        <button class="btn btn-success btn-lg" onclick="startGame()">Start Game</button>
                    </div>
                </div>
            </div>

            <!-- Chat -->
            <div class="col-md-3 d-flex flex-column">
                <%- include('gameChat.ejs') %>
            </div>
        </div>
    </div>
</div>

<!-- Add shared models before your game scripts -->
<script src="/shared/models/Player.js"></script>
<script src="/shared/models/PlayerList.js"></script>
<script src="/shared/models/Message.js"></script>
<script src="/shared/models/Chat.js"></script>
<script src="/js/controllers/ClientGameSessionController.js"></script>
<script src="/js/controllers/ClientChatController.js"></script>
<script>
    const gameShortId = '<%= gameSession.short_id %>';
    const gameSession = <%- JSON.stringify(gameSession) %>;
</script>
<script src="js/game.js"></script>

<script id="player-list-item" type="text/x-handlebars-template">
    <%- include('../../shared/views/player-list-item.hbs', {
        gameShortId: gameShortId,
        gameSession: gameSession,
        players: players
    }) %>
</script>
