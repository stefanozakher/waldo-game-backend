<!-- views/pages/game.ejs -->
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h2>Game Session: <%= gameSession.short_id %></h2>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="game-status">
                            Status: <span id="gameStatus" class="badge 
                                <%= gameSession.status === 'waiting' ? 'badge-secondary' :
                                    gameSession.status === 'playing' ? 'badge-primary' :
                                    gameSession.status === 'completed' ? 'badge-success' : 'badge-info' %>">
                                <%= gameSession.status.charAt(0).toUpperCase() + gameSession.status.slice(1) %>
                            </span>
                        </div>
                        <% if (gameSession.status !== 'completed') { %>
                            <div class="timer-container">
                                <span class="timer-label">Time:</span>
                                <span id="gameSessionTimer" class="timer-value">
                                    <% if (gameSession.status === 'playing') { %>
                                        <% var elapsedSeconds = Math.floor((gameSession.started_at + (gameSession.playtime_in_seconds * 1000) - Date.now()) / 1000) %>
                                        <%= Math.floor(elapsedSeconds / 60) %>:<%= (elapsedSeconds % 60).toString().padStart(2, '0') %>
                                    <% } else { %>
                                        <%= Math.floor(gameSession.playtime_in_seconds / 60) %>:<%= (gameSession.playtime_in_seconds % 60).toString().padStart(2, '0') %>
                                    <% } %>
                                </span>
                            </div>
                        <% } %>
                    </div>
                </div>
                <div class="card-body">
                    <h3>Players</h3>
                    <ul class="list-group" id="playersList">
                    </ul>
                    <!-- Add this new div for the start button -->
                    <div id="startGameContainer" class="text-center mt-3" style="display: none;">
                        <button class="btn btn-success btn-lg" onclick="startGame()">Start Game</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add shared models before your game scripts -->
<script src="/shared/models/Player.js"></script>
<script src="/shared/models/PlayerList.js"></script>
<script src="/js/controllers/ClientPlayerListController.js"></script>
<script src="/js/controllers/ClientGameSessionController.js"></script>
<script>
    const gameShortId = '<%= gameSession.short_id %>';
    const gameSession = <%- JSON.stringify(gameSession) %>;
</script>
<script src="js/game.js"></script>

<script id="player-list-item" type="text/x-handlebars-template">
    <%- include('../../shared/views/player-list-item.hbs', {
        gameShortId: gameShortId,
        gameSession: gameSession,
        players: players
    }) %>
</script>
